/*
 * absEncoder.cpp
 *
 *  Created on: Jan 2, 2021
 *      Author: Duane Mathias
 */

#include "absEncoder.h"

absEncoder::absEncoder(GPIO_TypeDef* gpioPorts[10], uint8_t gpioPins[10]):ports(gpioPorts),pins(gpioPins) {

}

absEncoder::~absEncoder() {
	// TODO Auto-generated destructor stub
}

uint16_t absEncoder::position(){
	// read all gpio at once
	uint16_t a = GPIOA->IDR;
	uint16_t b = GPIOB->IDR;
	uint16_t c = GPIOC->IDR;

	//construct greycode
	uint16_t grey = 0;
	uint16_t p = 0;
	uint8_t b = 0;
	for(int i = 0; i<10; i++){
		switch(ports[i]){
		case GPIOA:
			p = a;
			break;
		case GPIOB:
			p=b;
			break;
		case GPIOC:
			p=c;
			break;
		}
		b = (p&pins[i])>0;
		grey += b<<i;
	}


	//convert to binary
}
